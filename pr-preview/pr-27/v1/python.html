<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/macro-2018/pr-preview/pr-27/assets/css/style.css?v=a7b068a5e326c4a38f1fc49250e3726496a538bb">
    <link rel="icon" type="image/png" href="/macro-2018/pr-preview/pr-27/assets/favicons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/macro-2018/pr-preview/pr-27/assets/favicons/favicon.svg" />
    <link rel="shortcut icon" href="/macro-2018/pr-preview/pr-27/assets/favicons/favicon.ico" sizes="48x48 32x32" />
    <link rel="apple-touch-icon" sizes="180x180" href="/macro-2018/pr-preview/pr-27/assets/favicons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="MACRO-2018" />
    <link rel="manifest" href="/macro-2018/pr-preview/pr-27/assets/favicons/site.webmanifest" />
    <meta name="google-site-verification" content="FDsDvatXtMDAoGR0-B-hQSvLF7Pb1Zl0_986ettSGxI" />
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Access using Python | MACRO-2018</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Access using Python" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="The MACRO-2018 dataset is a high-resolution dataset of CO and CO2 concentrations in metropolitan areas in Germany in 2018." />
<meta property="og:description" content="The MACRO-2018 dataset is a high-resolution dataset of CO and CO2 concentrations in metropolitan areas in Germany in 2018." />
<link rel="canonical" href="https://atmo-iup-uhei.github.io/macro-2018/pr-preview/pr-27/v1/python.html" />
<meta property="og:url" content="https://atmo-iup-uhei.github.io/macro-2018/pr-preview/pr-27/v1/python.html" />
<meta property="og:site_name" content="MACRO-2018" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Access using Python" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"The MACRO-2018 dataset is a high-resolution dataset of CO and CO2 concentrations in metropolitan areas in Germany in 2018.","headline":"Access using Python","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://atmo-iup-uhei.github.io/macro-2018/pr-preview/pr-27/macro-2018/favicon.ico"}},"url":"https://atmo-iup-uhei.github.io/macro-2018/pr-preview/pr-27/v1/python.html"}</script>
<!-- End Jekyll SEO tag -->

  </head>
  <body>
    <header class="page-header" role="banner">
       
       
      <div class="page-header-bg">
        <div class="page-header-bg-eur">
          <img src="/macro-2018/pr-preview/pr-27/assets/images/TNO_eur.png " />
        </div>
        <img src="/macro-2018/pr-preview/pr-27/assets/images/TNO_ger.png " />
      </div>
      <div class="headline">
        <h1 class="project-name">MACRO-2018<sup><sub><sup>v1</sub></sup></h1>
      </div>
      <h2 class="project-tagline"><b>M</b>etropolitan <b>A</b>rea <b>C</b>O<sub>x</sub> <b>R</b>ec<b>O</b>rd of Germany 2018</h2>
      

<select id="version-switcher" onchange="window.location=this.value">
  <option
    value="/macro-2018/pr-preview/pr-27/v1/python.html"
    selected
  >
    v1
  </option>
  <option
    value="/macro-2018/pr-preview/pr-27/v2/python.html"
    
  >
    v2
  </option>
</select>
    </header>

    <button id="hamburger-menu" onclick="toggleSidebar()">â˜°</button>

    <div class="sidebar" id="sidebar">
      <ul>
        <li><b>v1</b></li>
        <li><a href="/macro-2018/pr-preview/pr-27/v1">Home</a></li>
        <li><a href="/macro-2018/pr-preview/pr-27/v1/documentation.html">Documentation</a></li>
        <li>Data Access</li>
        <ul>
          <li><a href="/macro-2018/pr-preview/pr-27/v1/python.html">Using Python</a></li>
          
          <li><a href="https://swiftbrowser.dkrz.de/public/dkrz_cf06e856-7ed9-4f16-9ffb-3c5526e68a9c/MACRO-2018/v1/">HTTPS Access</a></li>
          
        </ul>
      </ul>
    </div>

    <main id="content" class="main-content" role="main">
      <h2 id="preparing-your-environment-using-conda">Preparing your environment using Conda</h2>

<p>In order to be able to access the OpenStack Swift filesystem, you need a number of packages to be available.
Save the following as a file called <code class="language-plaintext highlighter-rouge">macro_access.yml</code> and then create a new conda environment using <code class="language-plaintext highlighter-rouge">conda env create -f macro_access.yml</code>.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name: macro_access
channels:
  - conda-forge
  - defaults
dependencies:
  - python=3.12
  - pip
  - xarray
  - zarr=2.18
  - dask
  - fsspec
  - pip:
      - attrs
      - swiftspec
</code></pre></div></div>
<p>Now, activate the newly created environment using <code class="language-plaintext highlighter-rouge">conda activate macro_access</code>.</p>

<h2 id="accessing-the-data">Accessing the data</h2>

<p>With the dependencies installed and the environment activated, we can access the data.
First we import the necessary packages:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import xarray as xr
from zarr.storage import FSStore, LRUStoreCache
</code></pre></div></div>
<p>Then, we generate a cached filestore from the Objects in the DKRZ OpenStack Swift.
More information regarding the domains can be found <a href="/macro-2018/pr-preview/pr-27/v1/documentation.html#domain-setup">here</a>.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>domain = 4  # Berlin
url = f"swift://swift.dkrz.de/dkrz_cf06e856-7ed9-4f16-9ffb-3c5526e68a9c/MACRO-2018/v1/wrfout_d{domain:02d}_2018.zarr"

store_nocache = FSStore(url)
store_cached = LRUStoreCache(store_nocache, max_size=2**30)
ds = xr.open_zarr(store_cached)
</code></pre></div></div>
<p>Finally we can use the remote data like it were on our computer locally.
The available WRF meteorology and tracer fields are described in the <a href="/macro-2018/pr-preview/pr-27/v1/documentation.html#data-structure">documentation page</a>.</p>


      <footer class="site-footer">
        
          <span class="site-footer-owner"><a href="https://github.com/ATMO-IUP-UHEI/macro-2018">macro-2018</a> is maintained by <a href="https://github.com/ATMO-IUP-UHEI">ATMO-IUP-UHEI</a>.</span>
        
        <span class="site-footer-credits">This page was built by Lukas Pilz and generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
      </footer>
    </main>

    <script>
      function toggleSidebar() {
        var sidebar = document.getElementById('sidebar');
        if (sidebar.style.display === 'block') {
          sidebar.style.display = 'none';
        } else {
          sidebar.style.display = 'block';
        }
      }
    </script>
  </body>
</html>
